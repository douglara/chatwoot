<!DOCTYPE html>
<html>
  <head>
    <title>SuperAdmin | Chatwoot</title>
    <%= javascript_pack_tag 'superadmin' %>
    <%= stylesheet_pack_tag 'superadmin' %>
  </head>
  <body data-gr-c-s-loaded="true">
    <div id="app" class="superadmin-body app-wrapper app-root">
      <div class="medium column login">
        <div class="text-center medium-12 login__hero align-self-top">
          <img
            src="/brand-assets/logo.svg"
            alt="Chatwoot logo"
            class="hero__logo"
          />
          <h2 class="hero--title">
            Leia o QR Code
          </h2>
        </div>
        <div class="row align-center">
          <div class="small-12 medium-4 column">
            <%= form_tag('/app/wpp_connect/create', class: 'login-box column align-self-top') do %>
              <div class="column log-in-form">
                <% if flash[:error].present? %>
                <div data-alert class="alert-box warning"><%= flash[:error] %></div>
                <% end %>
                <div class="m-4">
                  <img src="<%= "#{@qr_code}" %>" />
                </div>

                <%= link_to "Cancelar", app_wpp_connect_show_path(
                  api_access_token: params[:api_access_token], wpp_connect_id: @wpp_connect.id, account_id: params[:account_id]
                  ), style:"margin-top: 10px", class: "button nice large expanded" %>
              </div>
            <% end %>
          </div>
        </div>
    </div>
  </body>

    <script>
      function sleep (time) {
        return new Promise((resolve) => setTimeout(resolve, time));
      }
      sleep(5000).then(() => {
        window.location.replace('<%= "#{app_wpp_connect_qr_code_url(api_access_token: '7BfL27G5hiGHW7W8VmKASYHV', wpp_connect_id: @wpp_connect.id, account_id: params[:account_id], retries_count: @retries_count)}" %>');
      });
    </script>
</html>

